version: "3.3"
services:
  haproxy:
    build: ./docker/haproxy
    command: haproxy -c -f /usr/local/etc/haproxy/haproxy.cfg
  redis:
    image: "redis:alpine"
    hostname: "redis"
    ports: ["6379:6379"]
  rabbitmq:
    image: "rabbitmq:management-alpine"
    hostname: "rabbitmq"
    ports: ["15672:15672","5672:5672"]
  postgres:
    image: "postgres:alpine"
    hostname: "postgres"
  netty:
    build:
      context: .
      dockerfile: ./docker/netty/Dockerfile
    depends_on: ["redis","rabbitmq","postgres"]   
    ports: ["8080:8080"]
  userconsumer:
    build:
      context: .
      dockerfile: ./docker/consumers/UserConsumer.Dockerfile
    ports: ["8081:8081"]
    depends_on: ["redis","rabbitmq","postgres","netty"]
  questionconsumer:
    build:
      context: .
      dockerfile: ./docker/consumers/QuestionConsumer.Dockerfile
    ports: ["8082:8082"]
    depends_on: ["redis","rabbitmq","postgres","netty"]
  pollconsumer:
    build:
      context: .
      dockerfile: ./docker/consumers/PollConsumer.Dockerfile
    ports: ["8083:8083"]
    depends_on: ["redis","rabbitmq","postgres","netty"]
  notificationconsumer:
    build:
      context: .
      dockerfile: ./docker/consumers/NotificationConsumer.Dockerfile
    ports: ["8084:8084"] 
    depends_on: ["redis","rabbitmq","postgres","netty"]
  mediaconsumer:
    build:
      context: .
      dockerfile: ./docker/consumers/MediaConsumer.Dockerfile
    ports: ["8085:8085"]
    depends_on: ["redis","rabbitmq","postgres","netty"]
  courseconsumer:
    build:
      context: .
      dockerfile: ./docker/consumers/CourseConsumer.Dockerfile
    ports: ["8086:8086"]
    depends_on: ["redis","rabbitmq","postgres","netty"]
